@echo off
REM Automatically process the only .qmd file in the current directory

cd /d %~dp0

REM Find .qmd file
for %%f in (*.qmd) do (
  SET "QMD_FILE=%%f"
  goto found
)

echo No .qmd file found in this folder.
pause
exit /b 1

:found
echo Found Quarto file: %QMD_FILE%

REM Remove extension to get base name
for %%f in ("%QMD_FILE%") do (
  SET "BASENAME=%%~nf"
)

REM Render to HTML
echo Rendering to HTML with Quarto...
quarto render "%QMD_FILE%"
if %ERRORLEVEL% NEQ 0 (
  echo Quarto render failed.
  pause
  exit /b 1
)

REM Paths
SET "HTML_FILE=%BASENAME%.html"
SET "PDF_FILE=%BASENAME%.pdf"

REM Convert to PDF using Decktape
echo Exporting to PDF with Decktape...
decktape reveal file:///%cd:\=/%/%HTML_FILE% "%PDF_FILE%" --size 1920x1080
if %ERRORLEVEL% NEQ 0 (
  echo Decktape export failed.
  pause
  exit /b 1
)

echo Export complete: %PDF_FILE%
start "" "%PDF_FILE%"
pause